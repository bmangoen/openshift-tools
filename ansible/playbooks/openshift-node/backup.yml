---
- name: backup nodes configuration files
  hosts: nodes
  tasks:
  - import_role:
      name: openshift_facts
      tasks_from: backup.yml
  - name: set /etc/origin backup directory
    set_fact:
      origin_backup_dir: "{{ openshift_backup_date }}/etc-origin"
  - debug:
     msg: "{{ backup_srv_path }}/{{ inventory_hostname }}/{{ origin_backup_dir }}"
  - name: create backup directories
    file:
      path: "{{ backup_srv_path }}/{{ inventory_hostname }}/{{ origin_backup_dir }}"
      state: directory
      recurse: true
    delegate_to: localhost
  - name: synchronize /etc/origin contents
    synchronize:
      src: /etc/origin/
      dest: "{{ backup_srv_path }}/{{ inventory_hostname }}/{{ origin_backup_dir }}"
      mode: pull
      archive: false
      recursive: true
